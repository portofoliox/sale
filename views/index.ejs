<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ADPanel Complete</title>
  <link rel="stylesheet" href="/style.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
<div class="container">
  <h1>ADPanel Complete</h1>
  <form action="/upload" method="POST" enctype="multipart/form-data">
    <input type="file" name="file" accept=".zip" required>
    <button>Upload ZIP</button>
  </form>
  <h2>Bots</h2>
  <% bots.forEach(bot => { %>
  <div class="bot-box">
    <h3><%= bot %></h3>
    <form action="/start/<%= bot %>" method="POST"><button>Start</button></form>
    <form action="/stop/<%= bot %>" method="POST"><button>Stop</button></form>
    <form action="/restart/<%= bot %>" method="POST"><button>Restart</button></form>
    <button onclick="showLogs('<%= bot %>')">Console</button>
    <button onclick="showFiles('<%= bot %>')">File Manager</button>
    <pre id="log-<%= bot %>" class="log"></pre>
    <div id="files-<%= bot %>" class="files"></div>
  </div>
  <% }) %>
</div>
<script>
  const socket = io();
  function showLogs(bot) {
    document.getElementById('log-' + bot).textContent = '';
    socket.emit('logs', bot);
    socket.on('log', data => {
      document.getElementById('log-' + bot).textContent += data;
    });
  }
  function showFiles(bot) {
    fetch('/files/' + bot).then(res => res.json()).then(files => {
      const container = document.getElementById('files-' + bot);
      container.innerHTML = '';
      files.forEach(f => {
        const link = document.createElement('a');
        link.href = `/file/${bot}/${f}`;
        link.textContent = f;
        link.target = '_blank';
        container.appendChild(link);
        container.appendChild(document.createElement('br'));
      });
    });
  }
</script>
</body>
</html>
