<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Manage <%= bot %></title>
<link rel="stylesheet" href="/style.css"><script src="/socket.io/socket.io.js"></script></head><body>
<h1>Manage Bot: <%= bot %></h1>
<div class="controls">
  <select id="scriptSelect"></select>
  <button onclick="run()">Run</button><button onclick="stop()">Stop</button>
  <select id="nodever"><% nodeVersions.forEach(v=>{%><option><%=v%></option><%})%></select>
  <button onclick="install()">Install Node.js</button>
</div>
<h2>Console</h2><pre id="console"></pre>
<div class="shell">
  <input id="shellcmd" placeholder="Enter shell command"><button onclick="shell()">Send</button>
</div>
<h2>File Manager</h2><div id="breadcrumbs"></div><ul id="entries"></ul>
<input type="file" id="fileUpload"><button onclick="upload()">Upload File</button>
<div id="editor" style="display:none;">
  <h3 id="edit-path"></h3><textarea id="edit-content"></textarea><br>
  <button onclick="save()">Save</button><button onclick="discard()">Discard</button>
</div>
<script>
const bot="<%= bot %>", socket=io(), consoleEl=document.getElementById('console');
socket.on('output',d=>consoleEl.textContent+=d);
socket.on('fileData',d=>{ document.getElementById('editor').style.display='block'; document.getElementById('edit-path').textContent=d.path; const ta=document.getElementById('edit-content'); ta.value=d.content; ta.dataset.original=d.content; });
function loadExplorer(path=''){ fetch(`/explore/${bot}?path=${encodeURIComponent(path)}`).then(r=>r.json()).then(data=>{ document.getElementById('breadcrumbs').innerHTML=data.path.split('/').filter(Boolean).map((p,i)=>`<a href="#" onclick="loadExplorer('${data.path.split('/').slice(0,i+1).join('/')}')">${p}</a>`).join(' / '); const ul=document.getElementById('entries'); ul.innerHTML=''; data.entries.forEach(e=>{ const li=document.createElement('li'); li.textContent=(e.isDir?'[DIR] ':'')+e.name; li.onclick=()=>e.isDir?loadExplorer(data.path?data.path+'/'+e.name:e.name):socket.emit('readFile',{bot,path:data.path?data.path+'/'+e.name:e.name}); const del=document.createElement('button'); del.textContent='Del'; del.onclick=ev=>{ev.stopPropagation();socket.emit('deleteFile',{bot,path:data.path?data.path+'/'+e.name:e.name,isDir:e.isDir}); loadExplorer(data.path);}; li.appendChild(del); ul.appendChild(li); }); document.getElementById('scriptSelect').innerHTML=data.entries.filter(e=>!e.isDir&&e.name.endsWith('.js')).map(e=>`<option>${e.name}</option>`).join(''); }); }
function run(){ consoleEl.textContent=''; socket.emit('action',{bot,cmd:'run',file:document.getElementById('scriptSelect').value}); }
function stop(){ socket.emit('action',{bot,cmd:'stop'}); }
function install(){ socket.emit('action',{bot,cmd:'install',version:document.getElementById('nodever').value}); }
function upload(){ const f=document.getElementById('fileUpload').files[0]; if(!f) return; const fd=new FormData(); fd.append('file',f); fetch('/upload',{method:'POST',body:fd}).then(()=>loadExplorer()); }
function save(){ socket.emit('writeFile',{bot,path:document.getElementById('edit-path').textContent,content:document.getElementById('edit-content').value}); }
function discard(){ document.getElementById('edit-content').value=document.getElementById('edit-content').dataset.original; }
function shell(){ const cmd=document.getElementById('shellcmd').value; if(cmd) socket.emit('action',{bot,cmd:'shell',command:cmd}); }
loadExplorer();
</script>
</body></html>
