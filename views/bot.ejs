<!DOCTYPE html>
<html>
<head><title>ADPanel</title></head>
<body>
  <h1>Select Script</h1>
  <input type="file" id="fileInput" accept=".js,.html" />
  <button id="uploadBtn">Upload</button>
  <br><br>
  <label>Script:</label>
  <select id="scriptSelect"></select>
  <label>Port:</label>
  <input type="number" id="portInput" value="3000" />
  <button id="runBtn">Run</button>
  <pre id="console"></pre>
<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
document.getElementById('uploadBtn').onclick = () => {
  const file = document.getElementById('fileInput').files[0];
  const data = new FormData();
  data.append('file', file);
  fetch('/upload', {method:'POST', body:data}).then(()=>refresh());
};
document.getElementById('runBtn').onclick = () => {
  const file = document.getElementById('scriptSelect').value;
  const port = document.getElementById('portInput').value;
  socket.emit('run',{bot:file.split('/')[0], file, port});
};
function refresh() {
  fetch('/list').then(r=>r.json()).then(data=>{
    const sel = document.getElementById('scriptSelect');
    sel.innerHTML = '';
    data.forEach(item=>{
      if(item.endsWith('.js')||item.endsWith('.html')){
        const opt = document.createElement('option');
        opt.value = item; opt.text = item;
        sel.add(opt);
      }
    });
  });
}
socket.on('output', msg => {
  document.getElementById('console').textContent += msg;
});
refresh();
</script>
</body>
</html>
